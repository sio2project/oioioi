name: Cypress nightly tests

on:
  schedule:
    - cron: '15 5 * * *'
  workflow_dispatch:

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Install `easy_toolbox.py` requirements
        run: |
          python -m pip install --upgrade pip
          pip install -U inquirer
      - name: Build OIOIOI
        run: |
          python easy_toolbox.py build --no-input
      - name: Run environment
        run: |
          python easy_toolbox.py up --no-input
          python easy_toolbox.py run --no-input &
      - name: Run tests
        run: |
          pushd oioioi_cypress
          yarn
          npx wait-on http://localhost:8000
          CYPRESS_baseUrl=http://localhost:8000 yarn cy:run
          popd
